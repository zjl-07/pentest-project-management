import React from "react";
import { withRouter, Link } from "react-router-dom";
import { Form, Field } from "react-final-form";
import { TextField } from "final-form-material-ui";
import { Paper, Button } from "@material-ui/core";
import { loginStart } from "redux/user/user.action";
import { connect } from "react-redux";

const Login = ({ history, login }) => {
  const onSubmit = async values => {
    login(values, history);
  };

  const fieldProps = [
    { name: "email", label: "Email" },
    { name: "password", label: "Password", type: "password" }
  ];

  const renderField = () =>
    fieldProps.map(field => (
      <Field
        key={field.name}
        fullWidth
        component={TextField}
        margin="normal"
        variant="outlined"
        {...field}
      />
    ));

  return (
    <div className="login-register">
      <Form
        onSubmit={onSubmit}
        render={({ handleSubmit, submitting, values }) => (
          <form onSubmit={handleSubmit} noValidate>
            <Paper className="login-register_content">
              <h2 className="center">Login</h2>
              {renderField()}
              <div className="center u-margin-top-medium u-margin-bottom-small">
                <Button
                  variant="contained"
                  color="primary"
                  className="medium-size"
                  type="submit"
                >
                  Sign in
                </Button>
              </div>
              <pre className="center">
                Don't have any account?{" "}
                <Link to="/register">Register Here!</Link>
              </pre>
            </Paper>
          </form>
        )}
      />
    </div>
  );
};

const mapDispatchToProps = dispatch => ({
  login: (values, history) => dispatch(loginStart(values, history))
});

export default withRouter(connect(null, mapDispatchToProps)(Login));

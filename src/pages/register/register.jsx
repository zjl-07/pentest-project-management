import React from "react";
import { withRouter, Link } from "react-router-dom";
import { connect } from "react-redux";
import { Form, Field } from "react-final-form";
import { TextField, Select } from "final-form-material-ui";
import { Paper, Button, MenuItem } from "@material-ui/core";
import { registerStart } from "redux/user/user.action";

const Register = ({ history, register }) => {
  const onSubmit = async values => {
    register(values, history);
  };

  const fieldProps = [
    { name: "name", label: "Name", component: TextField },
    { name: "email", label: "Email", component: TextField },
    {
      name: "password",
      label: "Password",
      type: "password",
      component: TextField
    },
    {
      name: "role",
      label: "Role",
      component: Select,
      formControlProps: {
        fullWidth: true,
        variant: "outlined",
        className: "u-margin-top-small"
      }
    }
  ];

  const selectValue = ["project manager", "user", "admin"];

  const renderField = () =>
    fieldProps.map(field =>
      field.name === "role" ? (
        <Field key={field.name} {...field}>
          {selectValue.map(value => (
            <MenuItem key={value} value={value}>
              {value}
            </MenuItem>
          ))}
        </Field>
      ) : (
        <Field
          key={field.name}
          fullWidth
          margin="normal"
          variant="outlined"
          {...field}
        />
      )
    );

  return (
    <div className="login-register">
      <Form
        onSubmit={onSubmit}
        render={({ handleSubmit, submitting, values }) => (
          <form onSubmit={handleSubmit} noValidate>
            <Paper className="login-register_content">
              <h2 className="center">Register</h2>
              {renderField()}
              <div className="center u-margin-top-medium u-margin-bottom-small">
                <Button
                  variant="contained"
                  color="primary"
                  className="medium-size"
                  type="submit"
                >
                  sign up
                </Button>
              </div>
              <pre className="center">
                Already have account? <Link to="/login">Sign In Here!</Link>
              </pre>
            </Paper>
          </form>
        )}
      />
    </div>
  );
};

const mapDispatchToProps = dispatch => ({
  register: (values, history) => dispatch(registerStart(values, history))
});

export default withRouter(connect(null, mapDispatchToProps)(Register));

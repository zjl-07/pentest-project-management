import React, { useState, useEffect } from "react";
import { withRouter } from "react-router-dom";
import { connect } from "react-redux";
import { createStructuredSelector } from "reselect";
import { selectAllCorporate } from "redux/corporate/corporate.selector";
import { deleteCorporateStart } from "redux/corporate/corporate.action";
import CardComponent from "components/card/card";
import DialogComponent from "components/dialog/dialog";
import Button from "@material-ui/core/Button";
import { fetchCorporateStart } from "redux/corporate/corporate.action";

const Corporate = ({
  company,
  history,
  match,
  deleteCorporateById,
  fetchCorporate
}) => {
  const [open, setModalStatus] = useState(false);
  const [corporate, setCorporate] = useState(undefined);

  const onToggleModal = company => {
    setModalStatus(!open);

    if (company !== undefined) {
      return setCorporate(company, [corporate]);
    }
  };

  useEffect(() => {
    fetchCorporate();
  }, [fetchCorporate]);

  return (
    <div className="main-corporate">
      <Button
        size="large"
        variant="contained"
        color="primary"
        className="addButton"
        onClick={() => history.push(`${match.path}corporate/add`)}
      >
        Add New Company
      </Button>
      <br />
      <div className="corporate">
        {company.map(company => (
          <CardComponent
            key={company._id}
            company={company}
            onToggleModal={() => onToggleModal(company)}
            deleteCard={() => deleteCorporateById(company._id)}
            editCard={() => history.push(`/corporate/${company._id}/edit`)}
          />
        ))}
        {corporate && (
          <DialogComponent
            modal={open}
            onToggleModal={() => onToggleModal(corporate)}
            company={corporate}
          />
        )}
      </div>
    </div>
  );
};

const mapStateToProps = createStructuredSelector({
  company: selectAllCorporate
});

const mapDispatchToProps = dispatch => ({
  deleteCorporateById: id => dispatch(deleteCorporateStart(id)),
  fetchCorporate: () => dispatch(fetchCorporateStart())
});

export default withRouter(
  connect(mapStateToProps, mapDispatchToProps)(Corporate)
);

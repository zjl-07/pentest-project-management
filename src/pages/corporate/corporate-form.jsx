import React, { Component } from "react";
import { createStructuredSelector } from "reselect";
import { withRouter } from "react-router-dom";
import { Form, Field } from "react-final-form";
import { connect } from "react-redux";
import { TextField } from "final-form-material-ui";
import { Paper, Grid, Button } from "@material-ui/core";
import {
  addCorporateStart,
  fetchCorporateByIdStart,
  updateCorporateStart
} from "redux/corporate/corporate.action";
import { selectCorporateById } from "redux/corporate/corporate.selector";

class CorporateForm extends Component {
  state = {
    imageLink: {}
  };

  onSubmit = async values => {
    const { id } = this.props.match.params;
    const { history, addNewCorporate, updateCorporateById } = this.props;
    const { imageLink } = this.state;
    const newValues = { ...values, imageLink };

    id ? updateCorporateById(id, newValues) : addNewCorporate(newValues);

    history.goBack();
  };

  handleImageChange = e => {
    const imageLink = e.target.files[0];
    this.setState({ imageLink });
  };

  componentDidMount() {
    const { id } = this.props.match.params;
    const { fetchCorporateById } = this.props;

    if (id) {
      fetchCorporateById(id);
    }
  }

  render() {
    const { history, corporate } = this.props;

    return (
      <div className="customed_form">
        <div className="center">
          <h2>Add/Edit Corporate</h2>
          {console.log(corporate)}
        </div>
        <Form
          onSubmit={this.onSubmit}
          initialValues={{ ...corporate, imageLink: "" }}
          render={({ handleSubmit, submitting }) => (
            <form
              onSubmit={handleSubmit}
              noValidate
              encType="multipart/form-data "
            >
              <Paper className="customed_form-content">
                <Grid container alignItems="flex-start" spacing={2}>
                  <Grid item xs={6}>
                    <Field
                      fullWidth
                      required
                      name="name"
                      component={TextField}
                      type="text"
                      label="Company Name"
                      variant="outlined"
                    />
                  </Grid>
                  <Grid item xs={6}>
                    <Field
                      fullWidth
                      required
                      name="email"
                      component={TextField}
                      type="text"
                      label="Email"
                      variant="outlined"
                    />
                  </Grid>
                  <Grid item xs={12}>
                    <Field
                      name="description"
                      component={TextField}
                      fullWidth
                      margin="normal"
                      label="Company Description"
                      variant="outlined"
                    />
                  </Grid>
                  <Grid item xs={12}>
                    <Field
                      name="address"
                      component={TextField}
                      fullWidth
                      margin="normal"
                      label="Company Address"
                      variant="outlined"
                    />
                  </Grid>
                  <Grid item xs={6}>
                    <Field
                      name="personInCharge"
                      component={TextField}
                      fullWidth
                      margin="normal"
                      label="Person In Charge"
                      variant="outlined"
                    />
                  </Grid>
                  <Grid item xs={6}>
                    <Field
                      name="phoneNumber"
                      component={TextField}
                      fullWidth
                      margin="normal"
                      label="Phone Number"
                      variant="outlined"
                    />
                  </Grid>
                  <Grid item xs={12}>
                    <span>Upload Company Image: </span>
                    <input
                      onChange={e => this.handleImageChange(e)}
                      type="file"
                      name="imageLink"
                    />
                  </Grid>
                </Grid>
                <Grid
                  item
                  xs={12}
                  style={{
                    marginTop: 16,
                    display: "flex",
                    justifyContent: "flex-end"
                  }}
                >
                  <Button
                    variant="contained"
                    color="default"
                    className="u-margin-right-small medium-size"
                    onClick={() => history.push("/")}
                  >
                    Cancel
                  </Button>

                  <Button
                    className="medium-size"
                    variant="contained"
                    color="primary"
                    type="submit"
                    disabled={submitting}
                  >
                    Submit
                  </Button>
                </Grid>
              </Paper>
            </form>
          )}
        />
      </div>
    );
  }
}

const mapStateToProps = createStructuredSelector({
  corporate: selectCorporateById
});

const mapDispatchToProps = dispatch => ({
  addNewCorporate: values => dispatch(addCorporateStart(values)),
  fetchCorporateById: id => dispatch(fetchCorporateByIdStart(id)),
  updateCorporateById: (id, form) => dispatch(updateCorporateStart(id, form))
});

export default withRouter(
  connect(mapStateToProps, mapDispatchToProps)(CorporateForm)
);

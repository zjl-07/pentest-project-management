import { all, takeLatest, call, put } from "redux-saga/effects";
import actionTypes from "./desc.actionTypes";
import { fetchDescSuccess } from "./desc.action";
import API from "API/jsonServer";
import { toast } from "react-toastify";
import { authHeader } from "utils/authHeader";

const fetchFromAPI = () =>
  API.get("/descs?sortBy=cwe:asc", {
    headers: authHeader()
  });

export function* fetchDesc() {
  try {
    const { data } = yield call(fetchFromAPI);
    yield put(fetchDescSuccess(data));
  } catch (error) {
    yield toast.error(`${error}`);
  }
}

export function* onFetchDescStart() {
  yield takeLatest(actionTypes.FETCH_DESC_START, fetchDesc);
}

export function* descSagas() {
  yield all([call(onFetchDescStart)]);
}

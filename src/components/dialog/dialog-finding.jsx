import React from "react";
import { withRouter } from "react-router-dom";
import { useStyles } from "./dialog.styles";
import {
  Button,
  Badge,
  Typography,
  Dialog,
  DialogActions,
  DialogContent,
  DialogTitle,
  TextField
} from "@material-ui/core";

const DialogFinding = ({ modal, data, onToggleModal, history, editable }) => {
  const classes = useStyles();

  const {
    user: { _id }
  } = JSON.parse(localStorage.getItem("currentUser"));

  const renderAddDifferentButtonVersion = () =>
    _id !== data.userId._id &&
    editable && (
      <DialogActions className={classes.AddVersionButton}>
        <Button
          onClick={() =>
            history.push(`/projects/${data.projectId}/vuln/${data._id}/add`)
          }
          color="primary"
          variant="contained"
          className="medium-size"
        >
          Add different version
        </Button>
      </DialogActions>
    );

  return (
    <Dialog
      open={modal}
      onClose={() => onToggleModal(data)}
      aria-labelledby="alert-dialog-title"
      aria-describedby="alert-dialog-description"
      className={classes.findingDialog}
    >
      <DialogTitle id="alert-dialog-title">
        <div className={classes.layout}>
          <Typography gutterBottom variant="h4">
            {data.name}
          </Typography>
          <Badge
            className={classes.status}
            badgeContent={data.status ? "DONE" : "CLOSED"}
            color={data.status ? "primary" : "secondary"}
          />
        </div>
      </DialogTitle>
      <DialogContent className={classes.findingDialogContent}>
        <TextField
          InputProps={{
            readOnly: true
          }}
          label="Create At"
          value={data.createdAt.slice(0, 10)}
          className={classes.textField}
          margin="normal"
          variant="outlined"
        />
        <TextField
          InputProps={{
            readOnly: true
          }}
          label="Description"
          multiline
          rows="5"
          value={data.description}
          className={classes.textField}
          margin="normal"
          variant="outlined"
        />
        <TextField
          InputProps={{
            readOnly: true
          }}
          multiline
          rows="5"
          label={data.desc.name}
          value={data.desc.description}
          className={classes.textField}
          margin="normal"
          variant="outlined"
        />
        <TextField
          InputProps={{
            readOnly: true
          }}
          multiline
          rows="2"
          label="Impact"
          value={data.desc.impact}
          className={classes.textField}
          margin="normal"
          variant="outlined"
        />
        <TextField
          InputProps={{
            readOnly: true
          }}
          multiline
          rows="2"
          label="Mitigation"
          value={data.desc.mitigation}
          className={classes.textField}
          margin="normal"
          variant="outlined"
        />
        <div className={classes.layout}>
          <TextField
            InputProps={{
              readOnly: true
            }}
            multiline
            label="CWE"
            rows="2"
            value={data.desc.cwe}
            className={classes.textFieldSmall}
            margin="normal"
            variant="outlined"
          />
          <TextField
            InputProps={{
              readOnly: true
            }}
            label="Location"
            multiline
            rows="2"
            value={data.location}
            className={classes.textFieldSecondary}
            margin="normal"
            variant="outlined"
          />
        </div>
        {!!data.fileName && (
          <div className="finding-media">
            <span>POC</span>
            <img src={data.poc} alt="finding-screenshot" />
          </div>
        )}
      </DialogContent>
      {renderAddDifferentButtonVersion()}
    </Dialog>
  );
};

export default withRouter(DialogFinding);

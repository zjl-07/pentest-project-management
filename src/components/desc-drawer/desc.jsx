import React, { useState } from "react";
import {
  ExpansionPanel,
  ExpansionPanelDetails,
  ExpansionPanelSummary,
  Divider
} from "@material-ui/core";
import { createStructuredSelector } from "reselect";
import { connect } from "react-redux";
import { selectAllDesc } from "redux/desc/desc.selector";
import ExpandMoreIcon from "@material-ui/icons/ExpandMore";
import SearchIcon from "@material-ui/icons/Search";

const DescDrawer = ({ desc }) => {
  const [expanded, setExpanded] = useState(false);
  const [search, setSearhValue] = useState("");

  const handleChange = panel => (event, isExpanded) => {
    setExpanded(isExpanded ? panel : false);
  };

  const filteredDesc = desc.filter(
    desc => desc.name.toLowerCase().indexOf(search.toLowerCase()) !== -1
  );

  const handleFilter = e => setSearhValue(e.target.value);

  return (
    <div className="desc">
      <h3 className="center u-margin-bottom-small">Attack Guideline</h3>
      <div className="search u-margin-bottom-small">
        <div className="search-icon">
          <SearchIcon />
        </div>
        <input
          type="text"
          placeholder="Searchâ€¦"
          className="search-input"
          onChange={handleFilter}
        />
      </div>

      {filteredDesc.map(desc => (
        <ExpansionPanel
          key={desc._id}
          expanded={expanded === desc._id}
          onChange={handleChange(desc._id)}
        >
          <ExpansionPanelSummary
            expandIcon={<ExpandMoreIcon />}
            aria-controls="panel1bh-content"
            id="panel1bh-header"
          >
            <p className="desc-title">{desc.name}</p>
          </ExpansionPanelSummary>
          <ExpansionPanelDetails>
            <div className="item desc-title space_between">
              <span>CWE</span>
              <span>{desc.cwe}</span>
            </div>
            <Divider />
            <div className="item description">
              <p className="desc-title">Description</p>
              <p>{desc.description}</p>
            </div>
            <Divider />
            <div className="item description">
              <p className="desc-title">Impact</p>
              <p>{desc.impact}</p>
            </div>
            <Divider />
            <div className="item description">
              <p className="desc-title">Mitigation</p>
              <p>{desc.mitigation}</p>
            </div>
          </ExpansionPanelDetails>
        </ExpansionPanel>
      ))}
    </div>
  );
};

const mapStateToProps = createStructuredSelector({
  desc: selectAllDesc
});

export default connect(mapStateToProps, null)(DescDrawer);

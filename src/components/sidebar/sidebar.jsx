import React, { useState } from "react";
import { withRouter } from "react-router-dom";
import { connect } from "react-redux";
import { createStructuredSelector } from "reselect";
import { selectCurrentUser } from "redux/user/user.selector";
import SupervisorAccountIcon from "@material-ui/icons/SupervisorAccount";
import AssignmentIcon from "@material-ui/icons/Assignment";
import AssignmentIndIcon from "@material-ui/icons/AssignmentInd";
import BusinessIcon from "@material-ui/icons/Business";
import Avatar from "@material-ui/core/Avatar";

const Sidebar = ({ isActive, history, user }) => {
  const {
    user: { role }
  } = JSON.parse(localStorage.getItem("currentUser"));
  const [active, setActive] = useState("");
  const [sidebarList] = useState([
    {
      id: 1,
      icon: <BusinessIcon fontSize="large" />,
      name: "Corporate List",
      link: "/"
    },
    {
      id: 2,
      icon: <AssignmentIcon fontSize="large" />,
      name: "All Projects",
      link: "/all-projects"
    },
    {
      id: 3,
      icon: <AssignmentIndIcon fontSize="large" />,
      name: "My Projects",
      link: "/my-projects"
    }
  ]);

  const onSidebarListToggle = value => setActive(value);
  const sidebarActive = value => (value === active ? "sidebar_active" : "");

  const renderSidebar = () =>
    sidebarList.map(list => (
      <li
        key={list.id}
        onClick={() => {
          onSidebarListToggle(list.name);
          history.push(`${list.link}`);
        }}
        className={`${sidebarActive(list.name)}`}
      >
        {list.icon}
        <div className="title">{list.name}</div>
      </li>
    ));

  const renderUserSidebar = () => (
    <li
      onClick={() => {
        onSidebarListToggle("users");
        history.push("users");
      }}
      className={`${sidebarActive("users")}`}
    >
      <SupervisorAccountIcon fontSize="large" />
      <div className="title">Users</div>
    </li>
  );

  return (
    <div className={`sidebar ${isActive}`}>
      <ul>
        {user && (
          <div className="profile">
            <div className="image">
              <Avatar className="avatar">{user.name.slice(0, 1)}</Avatar>
            </div>
            <div className="desc">
              <p className="name">{user.name}</p>
              <p className="position">{user.role}</p>
            </div>
          </div>
        )}
        {renderSidebar()}
        {role !== "user" && renderUserSidebar()}
      </ul>
    </div>
  );
};

const mapStateToProps = createStructuredSelector({
  user: selectCurrentUser
});

export default withRouter(connect(mapStateToProps, null)(Sidebar));
